!function(n){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(e){return n(e,window,document)}):"object"==typeof exports?module.exports=function(e,t){return e||(e=window),t&&t.fn.dataTable||(t=require("datatables.net")(e,t).$),n(t,e,e.document)}:n(jQuery,window,document)}(function(h,p,y,k){"use strict";var a=h.fn.dataTable,o=function(e,t){if(!a.versionCheck||!a.versionCheck("1.10.8"))throw"KeyTable requires DataTables 1.10.8 or newer";this.c=h.extend(!0,{},a.defaults.keyTable,o.defaults,t),this.s={dt:new a.Api(e),enable:!0,focusDraw:!1,waitingForDraw:!1,lastFocus:null},this.dom={};var n=this.s.dt.settings()[0],s=n.keytable;if(s)return s;(n.keytable=this)._constructor()};return h.extend(o.prototype,{blur:function(){this._blur()},enable:function(e){this.s.enable=e},focus:function(e,t){this._focus(this.s.dt.cell(e,t))},focused:function(e){if(!this.s.lastFocus)return!1;var t=this.s.lastFocus.cell.index();return e.row===t.row&&e.column===t.column},_constructor:function(){this._tabInput();var l=this,a=this.s.dt,e=h(a.table().node());if("static"===e.css("position")&&e.css("position","relative"),h(a.table().body()).on("click.keyTable","th, td",function(e){if(!1!==l.s.enable){var t=a.cell(this);t.any()&&l._focus(t,null,!1,e)}}),h(y).on("keydown.keyTable",function(e){l._key(e)}),this.c.blurable&&h(y).on("mousedown.keyTable",function(e){h(e.target).parents(".dataTables_filter").length&&l._blur(),h(e.target).parents().filter(a.table().container()).length||h(e.target).parents("div.DTE").length||h(e.target).parents("div.editor-datetime").length||h(e.target).parents().filter(".DTFC_Cloned").length||l._blur()}),this.c.editor){var s=this.c.editor;s.on("open.keyTableMain",function(e,t,n){"inline"!==t&&l.s.enable&&(l.enable(!1),s.one("close.keyTable",function(){l.enable(!0)}))}),this.c.editOnFocus&&a.on("key-focus.keyTable key-refocus.keyTable",function(e,t,n,s){l._editor(null,s,!0)}),a.on("key.keyTable",function(e,t,n,s,i){l._editor(n,i,!1)}),h(a.table().body()).on("dblclick.keyTable","th, td",function(e){!1!==l.s.enable&&(a.cell(this).any()&&l._editor(null,e,!0))})}a.settings()[0].oFeatures.bStateSave&&a.on("stateSaveParams.keyTable",function(e,t,n){n.keyTable=l.s.lastFocus?l.s.lastFocus.cell.index():null}),a.on("draw.keyTable",function(e){if(!l.s.focusDraw){var t=l.s.lastFocus;if(t&&t.node&&h(t.node).closest("body")===y.body){var n=l.s.lastFocus.relative,s=a.page.info(),i=n.row+s.start;if(0===s.recordsDisplay)return;i>=s.recordsDisplay&&(i=s.recordsDisplay-1),l._focus(i,n.column,!0,e)}}}),this.c.clipboard&&this._clipboard(),a.on("destroy.keyTable",function(){a.off(".keyTable"),h(a.table().body()).off("click.keyTable","th, td"),h(y).off("keydown.keyTable").off("click.keyTable").off("copy.keyTable").off("paste.keyTable")});var t=a.state.loaded();t&&t.keyTable?a.one("init",function(){var e=a.cell(t.keyTable);e.any()&&e.focus()}):this.c.focus&&a.cell(this.c.focus).focus()},_blur:function(){if(this.s.enable&&this.s.lastFocus){var e=this.s.lastFocus.cell;h(e.node()).removeClass(this.c.className),this.s.lastFocus=null,this._updateFixedColumns(e.index().column),this._emitEvent("key-blur",[this.s.dt,e])}},_clipboard:function(){var a=this.s.dt,o=this;p.getSelection&&(h(y).on("copy.keyTable",function(e){var t=e.originalEvent,n=p.getSelection().toString(),s=o.s.lastFocus;!n&&s&&(t.clipboardData.setData("text/plain",s.cell.render(o.c.clipboardOrthogonal)),t.preventDefault())}),h(y).on("paste.keyTable",function(e){var t,n=e.originalEvent,s=o.s.lastFocus,i=y.activeElement,l=o.c.editor;!s||i&&"body"!==i.nodeName.toLowerCase()||(n.preventDefault(),p.clipboardData&&p.clipboardData.getData?t=p.clipboardData.getData("Text"):n.clipboardData&&n.clipboardData.getData&&(t=n.clipboardData.getData("text/plain")),l?l.inline(s.cell.index()).set(l.displayed()[0],t).submit():(s.cell.data(t),a.draw(!1)))}))},_columns:function(){var e=this.s.dt,t=e.columns(this.c.columns).indexes(),n=[];return e.columns(":visible").every(function(e){-1!==t.indexOf(e)&&n.push(e)}),n},_editor:function(e,t,n){var s=this,i=this.s.dt,l=this.c.editor,a=this.s.lastFocus.cell;if(!(h("div.DTE",a.node()).length||null!==e&&(0<=e&&e<=9||11===e||12===e||14<=e&&e<=31||112<=e&&e<=123||127<=e&&e<=159))){t.stopPropagation(),13===e&&t.preventDefault();var o=function(){l.one("open.keyTable",function(){l.off("cancelOpen.keyTable"),n||h("div.DTE_Field_InputControl input, div.DTE_Field_InputControl textarea").select(),i.keys.enable(n?"tab-only":"navigation-only"),i.on("key-blur.editor",function(){l.displayed()&&l.submit()}),n&&h(i.table().container()).addClass("dtk-focus-alt"),l.on("submitUnsuccessful.keyTable",function(){s._focus(a,null,!1)}),l.one("close",function(){i.keys.enable(!0),i.off("key-blur.editor"),l.off(".keyTable"),h(i.table().container()).removeClass("dtk-focus-alt")})}).one("cancelOpen.keyTable",function(){l.off(".keyTable")}).inline(a.index())};13===e?(n=!0,h(y).one("keyup",function(){o()})):o()}},_emitEvent:function(n,s){this.s.dt.iterator("table",function(e,t){h(e.nTable).triggerHandler(n,s)})},_focus:function(e,t,n,s){var i=this,l=this.s.dt,a=l.page.info(),o=this.s.lastFocus;if(s||(s=null),this.s.enable){if("number"!=typeof e){if(!e.any())return;var r=e.index();if(t=r.column,(e=l.rows({filter:"applied",order:"applied"}).indexes().indexOf(r.row))<0)return;a.serverSide&&(e+=a.start)}if(-1!==a.length&&(e<a.start||e>=a.start+a.length))return this.s.focusDraw=!0,this.s.waitingForDraw=!0,void l.one("draw",function(){i.s.focusDraw=!1,i.s.waitingForDraw=!1,i._focus(e,t,k,s)}).page(Math.floor(e/a.length)).draw(!1);if(-1!==h.inArray(t,this._columns())){a.serverSide&&(e-=a.start);var c=l.cells(null,t,{search:"applied",order:"applied"}).flatten(),u=l.cell(c[e]);if(o){if(o.node===u.node())return void this._emitEvent("key-refocus",[this.s.dt,u,s||null]);this._blur()}var d=h(u.node());if(d.addClass(this.c.className),this._updateFixedColumns(t),n===k||!0===n){this._scroll(h(p),h(y.body),d,"offset");var f=l.table().body().parentNode;if(f!==l.table().header().parentNode){var b=h(f.parentNode);this._scroll(b,b,d,"position")}}this.s.lastFocus={cell:u,node:u.node(),relative:{row:l.rows({page:"current"}).indexes().indexOf(u.index().row),column:u.index().column}},this._emitEvent("key-focus",[this.s.dt,u,s||null]),l.state.save()}}},_key:function(e){if(this.s.waitingForDraw)e.preventDefault();else{var t=this.s.enable,n=!0===t||"navigation-only"===t;if(t)if(!(0===e.keyCode||e.ctrlKey||e.metaKey||e.altKey)||e.ctrlKey&&e.altKey)if(this.s.lastFocus){var s=this.s.dt,i=!!this.s.dt.settings()[0].oScroll.sY;if(!this.c.keys||-1!==h.inArray(e.keyCode,this.c.keys))switch(e.keyCode){case 9:this._shift(e,e.shiftKey?"left":"right",!0);break;case 27:this.s.blurable&&!0===t&&this._blur();break;case 33:case 34:n&&!i&&(e.preventDefault(),s.page(33===e.keyCode?"previous":"next").draw(!1));break;case 35:case 36:if(n){e.preventDefault();var l=s.cells({page:"current"}).indexes(),a=this._columns();this._focus(s.cell(l[35===e.keyCode?l.length-1:a[0]]),null,!0,e)}break;case 37:n&&this._shift(e,"left");break;case 38:n&&this._shift(e,"up");break;case 39:n&&this._shift(e,"right");break;case 40:n&&this._shift(e,"down");break;default:!0===t&&this._emitEvent("key",[s,e.keyCode,this.s.lastFocus.cell,e])}}}},_scroll:function(e,t,n,s){var i=n[s](),l=n.outerHeight(),a=n.outerWidth(),o=t.scrollTop(),r=t.scrollLeft(),c=e.height(),u=e.width();"position"===s&&(i.top+=parseInt(n.closest("table").css("top"),10)),i.top<o&&t.scrollTop(i.top),i.left<r&&t.scrollLeft(i.left),i.top+l>o+c&&l<c&&t.scrollTop(i.top+l-c),i.left+a>r+u&&a<u&&t.scrollLeft(i.left+a-u)},_shift:function(e,t,n){var s=this.s.dt,i=s.page.info(),l=i.recordsDisplay,a=this.s.lastFocus.cell,o=this._columns();if(a){var r=s.rows({filter:"applied",order:"applied"}).indexes().indexOf(a.index().row);i.serverSide&&(r+=i.start);var c=s.columns(o).indexes().indexOf(a.index().column),u=r,d=o[c];"right"===t?d=c>=o.length-1?(u++,o[0]):o[c+1]:"left"===t?d=0===c?(u--,o[o.length-1]):o[c-1]:"up"===t?u--:"down"===t&&u++,0<=u&&u<l&&-1!==h.inArray(d,o)?(e.preventDefault(),this._focus(u,d,!0,e)):n&&this.c.blurable?this._blur():e.preventDefault()}},_tabInput:function(){var t=this,n=this.s.dt,e=null!==this.c.tabIndex?this.c.tabIndex:n.settings()[0].iTabIndex;-1!=e&&h('<div><input type="text" tabindex="'+e+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(n.table().node()).children().on("focus",function(e){n.cell(":eq(0)",{page:"current"}).any()&&t._focus(n.cell(":eq(0)","0:visible",{page:"current"}),null,!0,e)})},_updateFixedColumns:function(e){var t=this.s.dt,n=t.settings()[0];if(n._oFixedColumns){var s=n._oFixedColumns.s.iLeftColumns,i=n.aoColumns.length-n._oFixedColumns.s.iRightColumns;(e<s||i<=e)&&t.fixedColumns().update()}}}),o.defaults={blurable:!0,className:"focus",clipboard:!0,clipboardOrthogonal:"display",columns:"",editor:null,editOnFocus:!1,focus:null,keys:null,tabIndex:null},o.version="2.5.0",h.fn.dataTable.KeyTable=o,h.fn.DataTable.KeyTable=o,a.Api.register("cell.blur()",function(){return this.iterator("table",function(e){e.keytable&&e.keytable.blur()})}),a.Api.register("cell().focus()",function(){return this.iterator("cell",function(e,t,n){e.keytable&&e.keytable.focus(t,n)})}),a.Api.register("keys.disable()",function(){return this.iterator("table",function(e){e.keytable&&e.keytable.enable(!1)})}),a.Api.register("keys.enable()",function(t){return this.iterator("table",function(e){e.keytable&&e.keytable.enable(t===k||t)})}),a.ext.selector.cell.push(function(e,t,n){var s=t.focused,i=e.keytable,l=[];if(!i||s===k)return n;for(var a=0,o=n.length;a<o;a++)(!0===s&&i.focused(n[a])||!1===s&&!i.focused(n[a]))&&l.push(n[a]);return l}),h(y).on("preInit.dt.dtk",function(e,t,n){if("dt"===e.namespace){var s=t.oInit.keys,i=a.defaults.keys;if(s||i){var l=h.extend({},i,s);!1!==s&&new o(t,l)}}}),o});